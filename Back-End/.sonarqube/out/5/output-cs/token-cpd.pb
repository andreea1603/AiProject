Ì
OC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Commands\CreatePostCommand.cs
	namespace 	

SentiTweet
 
. 
Commands 
{ 
public 

class 
User 
{ 
public		 
string		 
content		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
string

 
	sentiment

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
} 
} ¯
VC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Commands\CreatePostCommandHandler.cs
	namespace 	

SentiTweet
 
. 
Commands 
{ 
public 

class $
CreatePostCommandHandler )
{ 
} 
} Ñ
SC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Controllers\AnalysisController.cs
	namespace

 	
WebAPI


 
.

 
Controllers

 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
AnalysisController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
static 
	MLContext  )
	mlContext* 3
=4 5
new6 9
	MLContext: C
(C D
)D E
;E F
public 
readonly 
static 
PredictionEngine /
</ 0

ModelInput0 :
,: ;
ModelOutput< G
>G H
predictionEngineI Y
=Z [
	mlContext 
. 
Model 
. "
CreatePredictionEngine 2
<2 3

ModelInput3 =
,= >
ModelOutput? J
>J K
(K L
	mlContext 
. 
Model 
.  
Load  $
($ %
Path% )
.) *
GetFullPath* 5
(5 6
$str6 C
)C D
,D E
outF I
_J K
)K L
) 
; 
public 
AnalysisController !
(! "
)" #
{ 	
} 	
[ 	
HttpPost	 
] 
public 
ActionResult 
< 
int 
>  
Post! %
(% &
[& '
FromBody' /
]/ 0

ModelInput1 ;
data< @
)@ A
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return   

BadRequest   !
(  ! "
)  " #
;  # $
}!! 
return"" 
Ok"" 
("" 
AnalysisService"" %
.""% &
Predict""& -
(""- .
data"". 2
)""2 3
.""3 4

Prediction""4 >
)""> ?
;""? @
}## 	
[%% 	
HttpGet%%	 
]%% 
public&& 
ActionResult&& 
<&& 
int&& 
>&&  
Get&&! $
(&&$ %
[&&% &
	FromQuery&&& /
]&&/ 0

ModelInput&&1 ;

modelInput&&< F
)&&F G
{'' 	
if(( 
((( 
!(( 

ModelState(( 
.(( 
IsValid(( #
)((# $
{)) 
return** 

BadRequest** !
(**! "
)**" #
;**# $
}++ 
return-- 
Ok-- 
(-- 
AnalysisService-- %
.--% &
Predict--& -
(--- .

modelInput--. 8
)--8 9
.--9 :

Prediction--: D
)--D E
;--E F
}.. 	
}// 
}00 â
OC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Controllers\EvalController.cs
	namespace 	
WebAPI
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
EvalController 
:  !
ControllerBase" 0
{		 
} 
} ±/
PC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Controllers\TweetController.cs
	namespace		 	
WebAPI		
 
.		 
Controllers		 
{

 
[ 
Route 

(
 
$str 
)  
]  !
[ 
ApiController 
] 
public 

class 
TweetController  
:! "
ControllerBase# 1
{ 
public 
TweetController 
( 
)  
{! "
}# $
[ 	
HttpPost	 
] 
public 
ActionResult 
< 
int 
>  
Post! %
(% &
[& '
FromBody' /
]/ 0

ModelInput1 ;
data< @
)@ A
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "
)" #
;# $
} 
return 
Ok 
( 
AnalysisService %
.% &
Predict& -
(- .
data. 2
)2 3
.3 4

Prediction4 >
)> ?
;? @
} 	
[ 	
HttpGet	 
] 
[ 	
Produces	 
( 
$str $
)$ %
]% &
public 
ActionResult 
< 
String "
[" #
]# $
>$ %
Get& )
() *
[* +
	FromQuery+ 4
]4 5
String6 <

modelInput= G
)G H
{ 	
if   
(   
!   

ModelState   
.   
IsValid   #
)  # $
{!! 
return"" 

BadRequest"" !
(""! "
)""" #
;""# $
}## 
TweetService$$ 
client$$ 
=$$  !
new$$" %
TweetService$$& 2
($$2 3
)$$3 4
;$$4 5
var&& 
result&& 
=&& 
client&& 
.&&  !
GetPostByHashtagAsync&&  5
(&&5 6

modelInput&&6 @
)&&@ A
;&&A B

ModelInput(( 
modelInput1(( "
=((# $
new((% (

ModelInput(() 3
(((3 4
)((4 5
;((5 6
modelInput1)) 
.)) 
Col5)) 
=)) 
result)) %
.))% &
Result))& ,
[)), -
$num))- .
])). /
.))/ 0
Text))0 4
;))4 5
int,, 
numberOfPositives,, !
=,," #
$num,,$ %
,,,% &
numberOfNegative,,' 7
=,,8 9
$num,,: ;
;,,; <
string-- 
[-- 
]-- 
allInformation-- #
=--$ %
new--& )
string--* 0
[--0 1
$num--1 4
]--4 5
;--5 6
int// 
n// 
=// 
$num// 
,// 
p// 
=// 
$num// 
;// 
for11 
(11 
int11 
i11 
=11 
$num11 
;11 
i11 
<11 
result11  &
.11& '
Result11' -
.11- .
Length11. 4
;114 5
i116 7
++117 9
)119 :
{22 
modelInput133 
.33 
Col533  
=33! "
result33# )
.33) *
Result33* 0
[330 1
i331 2
]332 3
.333 4
Text334 8
;338 9
float55 
[55 
]55 
predict55 
=55  !
AnalysisService55" 1
.551 2*
SentimentPredictionProbability552 P
(55P Q
modelInput155Q \
)55\ ]
;55] ^
if77 
(77 
predict77 
[77 
$num77 
]77 
==77 !
$num77" #
)77# $
{88 
numberOfNegative:: $
++::$ &
;::& '
if;; 
(;; 
n;; 
<;; 
$num;; 
&&;; !
predict;;" )
[;;) *
$num;;* +
];;+ ,
>;;- .
$num;;/ 3
);;3 4
{<< 
n== 
++== 
;== 
allInformation>> &
[>>& '
n>>' (
]>>( )
=>>* +
result>>, 2
.>>2 3
Result>>3 9
[>>9 :
i>>: ;
]>>; <
.>>< =
Text>>= A
;>>A B
}?? 
}@@ 
elseAA 
{BB 
numberOfPositivesCC %
++CC% '
;CC' (
ifDD 
(DD 
pDD 
<DD 
$numDD 
&&DD !
predictDD" )
[DD) *
$numDD* +
]DD+ ,
>DD- .
$numDD/ 3
)DD3 4
{EE 
pFF 
++FF 
;FF 
allInformationGG &
[GG& '
pGG' (
]GG( )
=GG* +
resultGG, 2
.GG2 3
ResultGG3 9
[GG9 :
iGG: ;
]GG; <
.GG< =
TextGG= A
;GGA B
}HH 
}II 
}JJ 
allInformationKK 
[KK 
$numKK 
]KK 
=KK 
$strKK  6
+KK7 8
numberOfNegativeKK9 I
.KKI J
ToStringKKJ R
(KKR S
)KKS T
;KKT U
allInformationLL 
[LL 
$numLL 
]LL 
=LL 
$strLL  6
+LL7 8
numberOfPositivesLL9 J
.LLJ K
ToStringLLK S
(LLS T
)LLT U
;LLU V
returnNN 
OkNN 
(NN 
allInformationNN $
)NN$ %
;NN% &
}OO 	
}PP 
}QQ ÷6
LC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Controllers\TweetThread.cs
	namespace		 	
WebAPI		
 
.		 
Controllers		 
{

 
[ 
Route 

(
 
$str 
) 
]  
[ 
ApiController 
] 
public 

class !
TweetThreadController &
:' (
ControllerBase) 7
{ 
public !
TweetThreadController $
($ %
)% &
{' (
}) *
[ 	
HttpPost	 
] 
public 
ActionResult 
< 
int 
>  
Post! %
(% &
[& '
FromBody' /
]/ 0

ModelInput1 ;
data< @
)@ A
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "
)" #
;# $
} 
return 
Ok 
( 
AnalysisService %
.% &
Predict& -
(- .
data. 2
)2 3
.3 4

Prediction4 >
)> ?
;? @
} 	
[ 	
HttpGet	 
] 
[ 	
Produces	 
( 
$str $
)$ %
]% &
public 
ActionResult 
< 
String "
[" #
]# $
>$ %
Get& )
() *
[* +
	FromQuery+ 4
]4 5
String6 <

modelInput= G
)G H
{ 	
if   
(   
!   

ModelState   
.   
IsValid   #
)  # $
{!! 
return"" 

BadRequest"" !
(""! "
)""" #
;""# $
}## 
TweetService$$ 
client$$ 
=$$  !
new$$" %
TweetService$$& 2
($$2 3
)$$3 4
;$$4 5
var&& 
result&& 
=&& 
client&& 
.&&  
getRetweets&&  +
(&&+ ,

modelInput&&, 6
)&&6 7
;&&7 8

ModelInput)) 
modelInput1)) "
=))# $
new))% (

ModelInput))) 3
())3 4
)))4 5
;))5 6
modelInput1** 
.** 
Col5** 
=** 
result** %
[**% &
$num**& '
]**' (
;**( )
Console,, 
.,, 
	WriteLine,, 
(,, 
result,, $
),,$ %
;,,% &
int-- 
numberOfPositives-- !
=--" #
$num--$ %
,--% &
numberOfNegative--' 7
=--8 9
$num--: ;
;--; <
string.. 
[.. 
].. 
allInformation.. #
=..$ %
new..& )
string..* 0
[..0 1
$num..1 4
]..4 5
;..5 6
int00 
n00 
=00 
$num00 
,00 
p00 
=00 
$num00 
;00 
Console11 
.11 
	WriteLine11 
(11 
result11 $
.11$ %
Length11% +
)11+ ,
;11, -
for22 
(22 
int22 
i22 
=22 
$num22 
;22 
i22 
<22 
result22  &
.22& '
Length22' -
&&22. 0
!221 2
string222 8
.228 9
IsNullOrEmpty229 F
(22F G
result22G M
[22M N
i22N O
]22O P
)22P Q
;22Q R
i22S T
++22T V
)22V W
{33 
Console44 
.44 
	WriteLine44 !
(44! "
$str44" ?
)44? @
;44@ A
Console55 
.55 
	WriteLine55 !
(55! "
result55" (
[55( )
i55) *
]55* +
)55+ ,
;55, -
modelInput177 
.77 
Col577  
=77! "
result77# )
[77) *
i77* +
]77+ ,
;77, -
float99 
[99 
]99 
predict99 
=99  !
AnalysisService99" 1
.991 2*
SentimentPredictionProbability992 P
(99P Q
modelInput199Q \
)99\ ]
;99] ^
if<< 
(<< 
predict<< 
[<< 
$num<< 
]<< 
==<< !
$num<<" #
)<<# $
{== 
numberOfNegative?? $
++??$ &
;??& '
Console@@ 
.@@ 
	WriteLine@@ %
(@@% &
$str@@& B
)@@B C
;@@C D
ConsoleAA 
.AA 
	WriteLineAA %
(AA% &
numberOfNegativeAA& 6
)AA6 7
;AA7 8
ifBB 
(BB 
nBB 
<BB 
$numBB 
&&BB !
predictBB" )
[BB) *
$numBB* +
]BB+ ,
>BB- .
$numBB/ 3
)BB3 4
{CC 
nDD 
++DD 
;DD 
allInformationEE &
[EE& '
nEE' (
]EE( )
=EE* +
resultEE, 2
[EE2 3
iEE3 4
]EE4 5
;EE5 6
}FF 
}GG 
elseHH 
{II 
numberOfPositivesJJ %
++JJ% '
;JJ' (
ConsoleKK 
.KK 
	WriteLineKK %
(KK% &
$strKK& B
)KKB C
;KKC D
ConsoleLL 
.LL 
	WriteLineLL %
(LL% &
numberOfPositivesLL& 7
)LL7 8
;LL8 9
ifNN 
(NN 
pNN 
<NN 
$numNN 
&&NN !
predictNN" )
[NN) *
$numNN* +
]NN+ ,
>NN- .
$numNN/ 3
)NN3 4
{OO 
pPP 
++PP 
;PP 
allInformationQQ &
[QQ& '
pQQ' (
]QQ( )
=QQ* +
resultQQ, 2
[QQ2 3
iQQ3 4
]QQ4 5
;QQ5 6
}RR 
}SS 
}TT 
allInformationUU 
[UU 
$numUU 
]UU 
=UU 
$strUU  6
+UU7 8
numberOfNegativeUU9 I
.UUI J
ToStringUUJ R
(UUR S
)UUS T
;UUT U
allInformationVV 
[VV 
$numVV 
]VV 
=VV 
$strVV  6
+VV7 8
numberOfPositivesVV9 J
.VVJ K
ToStringVVK S
(VVS T
)VVT U
;VVU V
returnXX 
OkXX 
(XX 
allInformationXX $
)XX$ %
;XX% &
}YY 	
}ZZ 
}[[ ¿K
PC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Controllers\UsersController.cs
	namespace 	
WebAPI
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
UsersController  
:! "
ControllerBase# 1
{ 
private 
readonly 
IUserService %
_userService& 2
;2 3
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
AppSettings $
_appSettings% 1
;1 2
public 
UsersController 
( 
IUserService 
userService $
,$ %
IMapper 
mapper 
, 
IOptions 
< 
AppSettings  
>  !
appSettings" -
)- .
{ 	
_userService   
=   
userService   &
;  & '
_mapper!! 
=!! 
mapper!! 
;!! 
_appSettings"" 
="" 
appSettings"" &
.""& '
Value""' ,
;"", -
}## 	
[%% 	
AllowAnonymous%%	 
]%% 
[&& 	
HttpPost&&	 
(&& 
$str&&  
)&&  !
]&&! "
public'' 
IActionResult'' 
Authenticate'' )
('') *
[''* +
FromBody''+ 3
]''3 4
AuthenticateModel''5 F
model''G L
)''L M
{(( 	
var)) 
user)) 
=)) 
_userService)) #
.))# $
Authenticate))$ 0
())0 1
model))1 6
.))6 7
Username))7 ?
,))? @
model))A F
.))F G
Password))G O
)))O P
;))P Q
if++ 
(++ 
user++ 
==++ 
null++ 
)++ 
return,, 

BadRequest,, !
(,,! "
new,," %
{,,& '
message,,( /
=,,0 1
$str,,2 U
},,V W
),,W X
;,,X Y
var.. 
tokenHandler.. 
=.. 
new.. "#
JwtSecurityTokenHandler..# :
(..: ;
)..; <
;..< =
var// 
key// 
=// 
Encoding// 
.// 
ASCII// $
.//$ %
GetBytes//% -
(//- .
_appSettings//. :
.//: ;
Secret//; A
)//A B
;//B C
var00 
tokenDescriptor00 
=00  !
new00" %
	Microsoft00& /
.00/ 0
IdentityModel000 =
.00= >
Tokens00> D
.00D E#
SecurityTokenDescriptor00E \
{11 
Subject22 
=22 
new22 
ClaimsIdentity22 ,
(22, -
new22- 0
Claim221 6
[226 7
]227 8
{33 
new44 
Claim44 
(44 

ClaimTypes44 (
.44( )
Name44) -
,44- .
user44/ 3
.443 4
Id444 6
.446 7
ToString447 ?
(44? @
)44@ A
)44A B
}55 
)55 
,55 
Expires66 
=66 
DateTime66 "
.66" #
UtcNow66# )
.66) *
AddDays66* 1
(661 2
$num662 3
)663 4
,664 5
SigningCredentials77 "
=77# $
new77% (
SigningCredentials77) ;
(77; <
new77< ? 
SymmetricSecurityKey77@ T
(77T U
key77U X
)77X Y
,77Y Z
SecurityAlgorithms77[ m
.77m n 
HmacSha256Signature	77n 
)
77 
}88 
;88 
var99 
token99 
=99 
tokenHandler99 $
.99$ %
CreateToken99% 0
(990 1
tokenDescriptor991 @
)99@ A
;99A B
var:: 
tokenString:: 
=:: 
tokenHandler:: *
.::* +

WriteToken::+ 5
(::5 6
token::6 ;
)::; <
;::< =
return== 
Ok== 
(== 
new== 
{>> 
Id?? 
=?? 
user?? 
.?? 
Id?? 
,?? 
Username@@ 
=@@ 
user@@ 
.@@  
Username@@  (
,@@( )
	FirstNameAA 
=AA 
userAA  
.AA  !
	FirstNameAA! *
,AA* +
LastNameBB 
=BB 
userBB 
.BB  
LastNameBB  (
,BB( )
TokenCC 
=CC 
tokenStringCC #
}DD 
)DD 
;DD 
}EE 	
[GG 	
AllowAnonymousGG	 
]GG 
[HH 	
HttpPostHH	 
(HH 
$strHH 
)HH 
]HH 
publicII 
IActionResultII 
RegisterII %
(II% &
[II& '
FromBodyII' /
]II/ 0
RegisterModelII1 >
modelII? D
)IID E
{JJ 	
varLL 
userLL 
=LL 
_mapperLL 
.LL 
MapLL "
<LL" #
UserLL# '
>LL' (
(LL( )
modelLL) .
)LL. /
;LL/ 0
tryNN 
{OO 
_userServiceQQ 
.QQ 
CreateQQ #
(QQ# $
userQQ$ (
,QQ( )
modelQQ* /
.QQ/ 0
PasswordQQ0 8
)QQ8 9
;QQ9 :
returnRR 
OkRR 
(RR 
)RR 
;RR 
}SS 
catchTT 
(TT 
AppExceptionTT 
exTT  "
)TT" #
{UU 
returnWW 

BadRequestWW !
(WW! "
newWW" %
{WW& '
messageWW( /
=WW0 1
exWW2 4
.WW4 5
MessageWW5 <
}WW= >
)WW> ?
;WW? @
}XX 
}YY 	
[[[ 	
HttpGet[[	 
][[ 
public\\ 
IActionResult\\ 
GetAll\\ #
(\\# $
)\\$ %
{]] 	
var^^ 
users^^ 
=^^ 
_userService^^ $
.^^$ %
GetAll^^% +
(^^+ ,
)^^, -
;^^- .
var__ 
model__ 
=__ 
_mapper__ 
.__  
Map__  #
<__# $
IList__$ )
<__) *
	UserModel__* 3
>__3 4
>__4 5
(__5 6
users__6 ;
)__; <
;__< =
return`` 
Ok`` 
(`` 
model`` 
)`` 
;`` 
}aa 	
[cc 	
HttpGetcc	 
(cc 
$strcc 
)cc 
]cc 
publicdd 
IActionResultdd 
GetByIddd $
(dd$ %
intdd% (
iddd) +
)dd+ ,
{ee 	
varff 
userff 
=ff 
_userServiceff #
.ff# $
GetByIdff$ +
(ff+ ,
idff, .
)ff. /
;ff/ 0
vargg 
modelgg 
=gg 
_mappergg 
.gg  
Mapgg  #
<gg# $
	UserModelgg$ -
>gg- .
(gg. /
usergg/ 3
)gg3 4
;gg4 5
returnhh 
Okhh 
(hh 
modelhh 
)hh 
;hh 
}ii 	
[kk 	
HttpPutkk	 
(kk 
$strkk 
)kk 
]kk 
publicll 
IActionResultll 
Updatell #
(ll# $
intll$ '
idll( *
,ll* +
[ll, -
FromBodyll- 5
]ll5 6
UpdateModelll7 B
modelllC H
)llH I
{mm 	
varoo 
useroo 
=oo 
_mapperoo 
.oo 
Mapoo "
<oo" #
Useroo# '
>oo' (
(oo( )
modeloo) .
)oo. /
;oo/ 0
userpp 
.pp 
Idpp 
=pp 
idpp 
;pp 
tryrr 
{ss 
_userServiceuu 
.uu 
Updateuu #
(uu# $
useruu$ (
,uu( )
modeluu* /
.uu/ 0
Passworduu0 8
)uu8 9
;uu9 :
returnvv 
Okvv 
(vv 
)vv 
;vv 
}ww 
catchxx 
(xx 
AppExceptionxx 
exxx  "
)xx" #
{yy 
return{{ 

BadRequest{{ !
({{! "
new{{" %
{{{& '
message{{( /
={{0 1
ex{{2 4
.{{4 5
Message{{5 <
}{{= >
){{> ?
;{{? @
}|| 
}}} 	
[ 	

HttpDelete	 
( 
$str 
) 
] 
public
 
IActionResult
 
Delete
 #
(
# $
int
$ '
id
( *
)
* +
{
 	
_userService
 
.
 
Delete
 
(
  
id
  "
)
" #
;
# $
return
 
Ok
 
(
 
)
 
;
 
}
 	
}
 
} 
JC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\DataModels\ModelInput.cs
	namespace 	

SentiTweet
 
. 

DataModels 
{ 
public 
class 

ModelInput 
{ 	
[ 

ColumnName 
( 
$str 
) 
,  

LoadColumn! +
(+ ,
$num, -
)- .
]. /
public 
string 
Col0 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 

ColumnName 
( 
$str 
) 
,  

LoadColumn! +
(+ ,
$num, -
)- .
]. /
public 
float 
Col1 
{ 
get  #
;# $
set% (
;( )
}* +
[ 

ColumnName 
( 
$str 
) 
,  

LoadColumn! +
(+ ,
$num, -
)- .
]. /
public 
string 
Col2 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 

ColumnName 
( 
$str 
) 
,  

LoadColumn! +
(+ ,
$num, -
)- .
]. /
public 
string 
Col3 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 

ColumnName 
( 
$str 
) 
,  

LoadColumn! +
(+ ,
$num, -
)- .
]. /
public 
string 
Col4 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 

ColumnName 
( 
$str 
) 
,  

LoadColumn! +
(+ ,
$num, -
)- .
]. /
public 
string 
Col5 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 	
}   Ó
KC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\DataModels\ModelOutput.cs
	namespace 	

SentiTweet
 
. 

DataModels 
{ 
public 

class 
ModelOutput 
{ 
[ 	

ColumnName	 
( 
$str $
)$ %
]% &
public		 
String		 

Prediction		  
{		! "
get		# &
;		& '
set		( +
;		+ ,
}		- .
public

 
float

 
[

 
]

 
Score

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
} 
} ü
MC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\DataModels\SentimentData.cs
	namespace 	

SentiTweet
 
. 

DataModels 
{ 
public 

class 
SentimentData 
{ 
[ 	

LoadColumn	 
( 
$num 
) 
] 
public		 
string		 
SentimentText		 #
{		$ %
get		& )
;		) *
set		+ .
;		. /
}		0 1
[ 	

LoadColumn	 
( 
$num 
) 
, 

ColumnName "
(" #
$str# *
)* +
]+ ,
public 
bool 
	Sentiment 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} 
SC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\DataModels\SentimentPrediction.cs
	namespace 	

SentiTweet
 
. 

DataModels 
{ 
public 

class 
SentimentPrediction $
:% &
SentimentData' 4
{ 
[ 	

ColumnName	 
( 
$str $
)$ %
]% &
public 
bool 

Prediction 
{  
get! $
;$ %
set& )
;) *
}+ ,
public

 
float

 
Probability

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
float 
Score 
{ 
get  
;  !
set" %
;% &
}' (
} 
} é
WC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\DataModels\Users\AuthenticateModel.cs
	namespace 	
WebAPI
 
. 

DataModels 
. 
Users !
{ 
public 

class 
AuthenticateModel "
{ 
[ 	
Required	 
] 
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
[

 	
Required

	 
]

 
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} 	
SC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\DataModels\Users\RegisterModel.cs
	namespace 	
WebAPI
 
. 

DataModels 
. 
Users !
{ 
public 

class 
RegisterModel 
{ 
[ 	
Required	 
] 
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
[

 	
Required

	 
]

 
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ®
QC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\DataModels\Users\UpdateModel.cs
	namespace 	
WebAPI
 
. 

DataModels 
. 
Users !
{ 
public 

class 
UpdateModel 
{		 
public

 
string

 
	FirstName

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ¡
OC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\DataModels\Users\UserModel.cs
	namespace 	
WebAPI
 
. 

DataModels 
. 
Users !
{ 
public 

class 
	UserModel 
{		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ã	
BC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Entities\User.cs
	namespace 	
WebAPI
 
. 
Entities 
{ 
public 

class 
User 
{ 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 
string

 
	FirstName

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
byte 
[ 
] 
PasswordHash "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
byte 
[ 
] 
PasswordSalt "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} ë
IC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Helpers\AppException.cs
	namespace 	
WebAPI
 
. 
Helpers 
{ 
[ 
Serializable 
] 
public 

class 
AppException 
: 
	Exception! *
{		 
public

 
AppException

 
(

 
)

 
:

 
base

  $
(

$ %
)

% &
{

' (
}

) *
	protected 
AppException 
( 
SerializationInfo 0
info1 5
,5 6
StreamingContext7 G
contextH O
)O P
:P Q
baseR V
(V W
infoW [
,[ \
context] d
)d e
{f g
}h i
public 
AppException 
( 
string "
message# *
)* +
:, -
base. 2
(2 3
message3 :
): ;
{< =
}> ?
public 
AppException 
( 
string "
message# *
,* +
params, 2
object3 9
[9 :
]: ;
args< @
)@ A
: 
base 
( 
String 
. 
Format  
(  !
CultureInfo! ,
., -
CurrentCulture- ;
,; <
message= D
,D E
argsF J
)J K
)K L
{ 	
} 	
} 
} ©
HC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Helpers\AppSettings.cs
	namespace 	
WebAPI
 
. 
Helpers 
{ 
public 

class 
AppSettings 
{		 
public

 
string

 
Secret

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
} 
} 
NC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Helpers\AutoMapperProfile.cs
	namespace 	
WebAPI
 
. 
Helpers 
{ 
public 

class 
AutoMapperProfile "
:# $
Profile% ,
{ 
public		 
AutoMapperProfile		  
(		  !
)		! "
{

 	
	CreateMap 
< 
User 
, 
	UserModel %
>% &
(& '
)' (
;( )
	CreateMap 
< 
RegisterModel #
,# $
User% )
>) *
(* +
)+ ,
;, -
	CreateMap 
< 
UpdateModel !
,! "
User# '
>' (
(( )
)) *
;* +
} 	
} 
} 
HC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Helpers\DataContext.cs
	namespace 	
WebAPI
 
. 
Helpers 
{ 
public 

class 
DataContext 
: 
	DbContext (
{ 
	protected		 
readonly		 
IConfiguration		 )
Configuration		* 7
;		7 8
public 
DataContext 
( 
IConfiguration )
configuration* 7
)7 8
{ 	
Configuration 
= 
configuration )
;) *
} 	
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
string  
myDbConnectionString '
=( )
Configuration* 7
.7 8
GetConnectionString8 K
(K L
$strL R
)R S
;S T
optionsBuilder 
. 
UseMySQL #
(# $ 
myDbConnectionString$ 8
)8 9
;9 :
} 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} ð
KC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Helpers\SqlDataContext.cs
	namespace 	
WebAPI
 
. 
Helpers 
{ 
public 

class 
SqlDataContext 
:  !
DataContext" -
{ 
public		 
SqlDataContext		 
(		 
IConfiguration		 ,
configuration		- :
)		: ;
:		< =
base		> B
(		B C
configuration		C P
)		P Q
{		R S
}		S T
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
string  
myDbConnectionString '
=( )
Configuration* 7
.7 8
GetConnectionString8 K
(K L
$strL R
)R S
;S T
optionsBuilder 
. 
UseMySQL #
(# $ 
myDbConnectionString$ 8
)8 9
;9 :
} 	
} 
} ¤

<C:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Program.cs
	namespace 	
WebAPI
 
{ 
public 

static 
class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{		 	
CreateHostBuilder

 
(

 
args

 "
)

" #
.

# $
Build

$ )
(

) *
)

* +
.

+ ,
Run

, /
(

/ 0
)

0 1
;

1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{8 9

webBuilder: D
.D E

UseStartupE O
<O P
StartupP W
>W X
(X Y
)Y Z
;Z [
}\ ]
)] ^
;^ _
} 
} 6
MC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Services\AnalysisService.cs
	namespace 	
WebAPI
 
. 
Services 
{ 
public 

class 
AnalysisService  
:! "
IAnalysisService# 3
{4 5
private 
static 
Lazy 
< 
PredictionEngine ,
<, -

ModelInput- 7
,7 8
ModelOutput9 D
>D E
>E F
PredictionEngineG W
=X Y
newZ ]
Lazy^ b
<b c
PredictionEnginec s
<s t

ModelInputt ~
,~ 
ModelOutput
 
>
 
>
 
(
 $
CreatePredictionEngine
 ¤
)
¤ ¥
;
¥ ¦
public 
readonly 
static 
string %
MLNetModelPath& 4
=5 6
Path7 ;
.; <
GetFullPath< G
(G H
$strH U
)U V
;V W
public 
static 
ModelOutput !
Predict" )
() *

ModelInput* 4
input5 :
): ;
{ 	
ModelOutput 
result 
=  
PredictionEngine! 1
.1 2
Value2 7
.7 8
Predict8 ?
(? @
input@ E
)E F
;F G
return 
result 
; 
} 	
public 
static 
PredictionEngine &
<& '

ModelInput' 1
,1 2
ModelOutput3 >
>> ?"
CreatePredictionEngine@ V
(V W
)W X
{ 	
	MLContext 
	mlContext 
=  !
new" %
	MLContext& /
(/ 0
)0 1
;1 2
ITransformer 
mlModel  
=! "
	mlContext# ,
., -
Model- 2
.2 3
Load3 7
(7 8
MLNetModelPath8 F
,F G
outH K
varL O
modelInputSchemaP `
)` a
;a b
var 

predEngine 
= 
	mlContext &
.& '
Model' ,
., -"
CreatePredictionEngine- C
<C D

ModelInputD N
,N O
ModelOutputP [
>[ \
(\ ]
mlModel] d
)d e
;e f
return 

predEngine 
; 
} 	
public   
static   
SentimentPrediction   ) 
PredictionStatistics  * >
(  > ?

ModelInput  ? I

modelInput  J T
)  T U
{!! 	
SentimentData"" 
sampleStatement"" )
=""* +
new"", /
SentimentData""0 =
{## 
SentimentText$$ 
=$$ 

modelInput$$  *
.$$* +
Col5$$+ /
}%% 
;%% 
	MLContext&& 
	mlContext&& 
=&&  !
new&&" %
	MLContext&&& /
(&&/ 0
)&&0 1
;&&1 2
ITransformer'' 
mlModel''  
=''! "
	mlContext''# ,
.'', -
Model''- 2
.''2 3
Load''3 7
(''7 8
MLNetModelPath''8 F
,''F G
out''H K
var''L O
modelInputSchema''P `
)''` a
;''a b
PredictionEngine(( 
<(( 
SentimentData(( *
,((* +
SentimentPrediction((, ?
>((? @
predictionFunction((A S
=((T U
	mlContext((V _
.((_ `
Model((` e
.((e f"
CreatePredictionEngine((f |
<((| }
SentimentData	((} 
,
(( !
SentimentPrediction
(( 
>
((  
(
((  ¡
mlModel
((¡ ¨
)
((¨ ©
;
((© ª
var)) 
resultPrediction))  
=))! "
predictionFunction))# 5
.))5 6
Predict))6 =
())= >
sampleStatement))> M
)))M N
;))N O
return** 
resultPrediction** #
;**# $
}++ 	
public-- 
static-- 
float-- 
[-- 
]-- *
SentimentPredictionProbability-- <
(--< =

ModelInput--= G

modelInput--H R
)--R S
{.. 	
var// !
predictionEngineScore// %
=//& '
AnalysisController//( :
.//: ;
predictionEngine//; K
;//K L
var00 
modelOutput00 
=00 !
predictionEngineScore00 3
.003 4
Predict004 ;
(00; <

modelInput00< F
)00F G
;00G H
var22 
labelBuffer22 
=22 
new22 !
VBuffer22" )
<22) *
ReadOnlyMemory22* 8
<228 9
char229 =
>22= >
>22> ?
(22? @
)22@ A
;22A B!
predictionEngineScore33 !
.33! "
OutputSchema33" .
[33. /
$str33/ 6
]336 7
.337 8
Annotations338 C
.33C D
GetValue33D L
(33L M
$str33M X
,33X Y
ref33Z ]
labelBuffer33^ i
)33i j
;33j k
var44 
labels44 
=44 
labelBuffer44 $
.44$ %
DenseValues44% 0
(440 1
)441 2
.442 3
Select443 9
(449 :
l44: ;
=>44< >
l44? @
.44@ A
ToString44A I
(44I J
)44J K
)44K L
.44L M
ToArray44M T
(44T U
)44U V
;44V W
var66 
index66 
=66 
Array66 
.66 
IndexOf66 %
(66% &
labels66& ,
,66, -
modelOutput66. 9
.669 :

Prediction66: D
)66D E
;66E F
var77 
score77 
=77 
modelOutput77 #
.77# $
Score77$ )
[77) *
index77* /
]77/ 0
;770 1
float88 
[88 
]88 
array88 
=88 
new88 
float88  %
[88% &
$num88& '
]88' (
;88( )
array99 
[99 
$num99 
]99 
=99 
int99 
.99 
Parse99  
(99  !
modelOutput99! ,
.99, -

Prediction99- 7
)997 8
;998 9
array:: 
[:: 
$num:: 
]:: 
=:: 
score:: 
;:: 
return;; 
array;; 
;;; 
}<< 	
}?? 
}AA ¼
IC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Services\EvalService.cs
	namespace 	
WebAPI
 
. 
Services 
{ 
public 

class 
EvalService 
: 
IEvalService +
{, -
} 
} ¡
NC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Services\IAnalysisService.cs
	namespace 	
WebAPI
 
. 
Services 
{ 
public 

	interface 
IAnalysisService %
{& '
} 
} 
JC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Services\IEvalService.cs
	namespace 	
WebAPI
 
. 
Services 
{ 
public 

	interface 
IEvalService !
{" #
} 
} *
JC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Services\TweetService.cs
	namespace 	

SentiTweet
 
. 
Services 
{ 
public		 

class		 
TweetService		 
{

 
private 
readonly 
TwitterClient &

userClient' 1
;1 2
public 
TweetService 
( 
) 
{ 	

userClient 
= 
new 
TwitterClient )
() *
$str* E
,E F
$strG {
,{ |
$str	} ±
,
± ²
$str
³ â
)
â ã
;
ã ä
} 	
public 
async 
Task 
< 
	Tweetinvi #
.# $
Models$ *
.* +
V2+ -
.- .
TweetV2. 5
[5 6
]6 7
>7 8!
GetPostByHashtagAsync9 N
(N O
stringO U
hashtagV ]
)] ^
{ 	
var 
searchResponse 
=  
await! &

userClient' 1
.1 2
SearchV22 :
.: ;
SearchTweetsAsync; L
(L M
hashtagM T
)T U
;U V
var 
tweets 
= 
searchResponse '
.' (
Tweets( .
;. /
return 
tweets 
; 
} 
public 
String	 
[ 
] 
getRetweets 
( 
string $

tweets_url% /
,/ 0
int1 4
timeout_seconds5 D
=E F
$numG I
)I J
{ 
string 	
tweet_id
 
= 

tweets_url 
.  
Split  %
(% &
$char& )
)) *
[* +
^+ ,
$num, -
]- .
;. /
string 	
bearer_token
 
= 
$str	 
;
 
string 	
	final_url
 
= 
$str ]
+^ _
tweet_id 
+ 
$str L
;L M

HttpClient   
client   
=   
new   

HttpClient   %
(  % &
)  & '
;  ' (
client!! 	
.!!	 

BaseAddress!!
 
=!! 
new!! 
Uri!! 
(!!  
	final_url!!  )
)!!) *
;!!* +
client## 	
.##	 
!
DefaultRequestHeaders##
 
.##  
Authorization##  -
=##. /
new##0 3%
AuthenticationHeaderValue##4 M
(##M N
$str##N V
,##V W
bearer_token##X d
)##d e
;##e f
client$$ 	
.$$	 
!
DefaultRequestHeaders$$
 
.$$  
Accept$$  &
.$$& '
Add$$' *
($$* +
new%% +
MediaTypeWithQualityHeaderValue%% '
(%%' (
$str%%( :
)%%: ;
)&& 
;&& 
String'' 	
[''	 

]''
 
result'' 
='' 
new'' 
string'' 
['' 
$num'' "
]''" #
;''# $
HttpResponseMessage(( 
response(( 
=((  !
client((" (
.((( )
GetAsync(() 1
(((1 2
$str((2 4
)((4 5
.((5 6
Result((6 <
;((< =
if)) 
()) 
response)) 
.)) 
IsSuccessStatusCode)) #
)))# $
{** 
string++ 

responseBody++ 
=++ 
response++ "
.++" #
Content++# *
.++* +
ReadAsStringAsync+++ <
(++< =
)++= >
.++> ?
Result++? E
;++E F
dynamic-- 
stuff1-- 
=-- 

Newtonsoft-- 
.--  
Json--  $
.--$ %
JsonConvert--% 0
.--0 1
DeserializeObject--1 B
(--B C
responseBody--C O
)--O P
;--P Q
for00 
(00 	
int00	 
i00 
=00 
$num00 
;00 
i00 
<00 
stuff100 
.00 
data00 #
.00# $
Count00$ )
;00) *
i00+ ,
++00, .
)00. /
{11 
result22 
[22 
i22 
]22 
=22 
stuff122 
.22 
data22 
[22 
i22 
]22 
.22  
text22  $
;22$ %
}33 
}55 
else66 
{77 
Console88 
.88 
	WriteLine88 
(88 
$str88 !
,88! "
(88# $
int88$ '
)88' (
response88( 0
.880 1

StatusCode881 ;
,88; <
response88= E
.88E F
ReasonPhrase88F R
)88R S
;88S T
}99 
client;; 	
.;;	 

Dispose;;
 
(;; 
);; 
;;; 
return<< 	
result<<
 
;<< 
}== 
}>> 
}?? 
IC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Services\UserService.cs
	namespace 	

SentiTweet
 
. 
Services 
{ 
public 

class 
UserService 
{		 
}

 
} §z
KC:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Services\UserServicecs.cs
	namespace 	
WebAPI
 
. 
Services 
{ 
public		 

	interface		 
IUserService		 !
{

 
User 
Authenticate 
( 
string  
username! )
,) *
string+ 1
password2 :
): ;
;; <
IEnumerable 
< 
User 
> 
GetAll  
(  !
)! "
;" #
User 
GetById 
( 
int 
id 
) 
; 
User 
Create 
( 
User 
user 
, 
string %
password& .
). /
;/ 0
void 
Update 
( 
User 
user 
, 
string %
password& .
=/ 0
null1 5
)5 6
;6 7
void 
Delete 
( 
int 
id 
) 
; 
} 
public 

class 
UserService 
: 
IUserService +
{ 
private 
readonly 
DataContext $
_context% -
;- .
public 
UserService 
( 
DataContext &
context' .
). /
{ 	
_context 
= 
context 
; 
} 	
public 
User 
Authenticate  
(  !
string! '
username( 0
,0 1
string2 8
password9 A
)A B
{ 	
if 
( 
string 
. 
IsNullOrEmpty $
($ %
username% -
)- .
||/ 1
string2 8
.8 9
IsNullOrEmpty9 F
(F G
passwordG O
)O P
)P Q
return 
null 
; 
var!! 
user!! 
=!! 
_context!! 
.!!  
Users!!  %
.!!% &
Where!!& +
(!!+ ,
x!!, -
=>!!. 0
string!!1 7
.!!7 8
Equals!!8 >
(!!> ?
x!!? @
.!!@ A
Username!!A I
,!!I J
username!!K S
)!!S T
)!!T U
.!!U V
FirstOrDefault!!V d
(!!d e
)!!e f
;!!f g
if$$ 
($$ 
user$$ 
==$$ 
null$$ 
)$$ 
return%% 
null%% 
;%% 
if(( 
((( 
!(( 
VerifyPasswordHash(( #
(((# $
password(($ ,
,((, -
user((. 2
.((2 3
PasswordHash((3 ?
,((? @
user((A E
.((E F
PasswordSalt((F R
)((R S
)((S T
return)) 
null)) 
;)) 
return,, 
user,, 
;,, 
}-- 	
public// 
IEnumerable// 
<// 
User// 
>//  
GetAll//! '
(//' (
)//( )
{00 	
return11 
_context11 
.11 
Users11 !
;11! "
}22 	
public44 
User44 
GetById44 
(44 
int44 
id44  "
)44" #
{55 	
return66 
_context66 
.66 
Users66 !
.66! "
Find66" &
(66& '
id66' )
)66) *
;66* +
}77 	
public99 
User99 
Create99 
(99 
User99 
user99  $
,99$ %
string99& ,
password99- 5
)995 6
{:: 	
if<< 
(<< 
string<< 
.<< 
IsNullOrWhiteSpace<< )
(<<) *
password<<* 2
)<<2 3
)<<3 4
throw== 
new== 
AppException== &
(==& '
$str==' =
)=== >
;==> ?
if?? 
(?? 
_context?? 
.?? 
Users?? 
.?? 
Any?? "
(??" #
x??# $
=>??% '
x??( )
.??) *
Username??* 2
==??3 5
user??6 :
.??: ;
Username??; C
)??C D
)??D E
throw@@ 
new@@ 
AppException@@ &
(@@& '
$str@@' 4
+@@5 6
user@@7 ;
.@@; <
Username@@< D
+@@E F
$str@@G \
)@@\ ]
;@@] ^
byteBB 
[BB 
]BB 
passwordHashBB 
,BB  
passwordSaltBB! -
;BB- .
CreatePasswordHashCC 
(CC 
passwordCC '
,CC' (
outCC) ,
passwordHashCC- 9
,CC9 :
outCC; >
passwordSaltCC? K
)CCK L
;CCL M
userEE 
.EE 
PasswordHashEE 
=EE 
passwordHashEE  ,
;EE, -
userFF 
.FF 
PasswordSaltFF 
=FF 
passwordSaltFF  ,
;FF, -
_contextHH 
.HH 
UsersHH 
.HH 
AddHH 
(HH 
userHH #
)HH# $
;HH$ %
_contextII 
.II 
SaveChangesII  
(II  !
)II! "
;II" #
returnKK 
userKK 
;KK 
}LL 	
publicNN 
voidNN 
UpdateNN 
(NN 
UserNN 
userNN  $
,NN$ %
stringNN& ,
passwordNN- 5
=NN6 7
nullNN8 <
)NN< =
{OO 	
varPP 
userParameterPP 
=PP 
_contextPP  (
.PP( )
UsersPP) .
.PP. /
FindPP/ 3
(PP3 4
userPP4 8
.PP8 9
IdPP9 ;
)PP; <
;PP< =
ifRR 
(RR 
userParameterRR 
==RR  
nullRR! %
)RR% &
throwSS 
newSS 
AppExceptionSS &
(SS& '
$strSS' 7
)SS7 8
;SS8 9
ifVV 
(VV 
!VV 
stringVV 
.VV 
IsNullOrWhiteSpaceVV *
(VV* +
userVV+ /
.VV/ 0
UsernameVV0 8
)VV8 9
&&VV: <
userVV= A
.VVA B
UsernameVVB J
!=VVK M
userParameterVVN [
.VV[ \
UsernameVV\ d
)VVd e
{WW 
ifYY 
(YY 
_contextYY 
.YY 
UsersYY "
.YY" #
AnyYY# &
(YY& '
xYY' (
=>YY) +
xYY, -
.YY- .
UsernameYY. 6
==YY7 9
userYY: >
.YY> ?
UsernameYY? G
)YYG H
)YYH I
throwZZ 
newZZ 
AppExceptionZZ *
(ZZ* +
$strZZ+ 6
+ZZ7 8
userZZ9 =
.ZZ= >
UsernameZZ> F
+ZZG H
$strZZI \
)ZZ\ ]
;ZZ] ^
userParameter\\ 
.\\ 
Username\\ &
=\\' (
user\\) -
.\\- .
Username\\. 6
;\\6 7
}]] 
if`` 
(`` 
!`` 
string`` 
.`` 
IsNullOrWhiteSpace`` *
(``* +
user``+ /
.``/ 0
	FirstName``0 9
)``9 :
)``: ;
userParameteraa 
.aa 
	FirstNameaa '
=aa( )
useraa* .
.aa. /
	FirstNameaa/ 8
;aa8 9
ifcc 
(cc 
!cc 
stringcc 
.cc 
IsNullOrWhiteSpacecc *
(cc* +
usercc+ /
.cc/ 0
LastNamecc0 8
)cc8 9
)cc9 :
userParameterdd 
.dd 
LastNamedd &
=dd' (
userdd) -
.dd- .
LastNamedd. 6
;dd6 7
ifgg 
(gg 
!gg 
stringgg 
.gg 
IsNullOrWhiteSpacegg *
(gg* +
passwordgg+ 3
)gg3 4
)gg4 5
{hh 
byteii 
[ii 
]ii 
passwordHashii #
,ii# $
passwordSaltii% 1
;ii1 2
CreatePasswordHashjj "
(jj" #
passwordjj# +
,jj+ ,
outjj- 0
passwordHashjj1 =
,jj= >
outjj? B
passwordSaltjjC O
)jjO P
;jjP Q
userParameterll 
.ll 
PasswordHashll *
=ll+ ,
passwordHashll- 9
;ll9 :
userParametermm 
.mm 
PasswordSaltmm *
=mm+ ,
passwordSaltmm- 9
;mm9 :
}nn 
_contextpp 
.pp 
Userspp 
.pp 
Updatepp !
(pp! "
userParameterpp" /
)pp/ 0
;pp0 1
_contextqq 
.qq 
SaveChangesqq  
(qq  !
)qq! "
;qq" #
}rr 	
publictt 
voidtt 
Deletett 
(tt 
inttt 
idtt !
)tt! "
{uu 	
varvv 
uservv 
=vv 
_contextvv 
.vv  
Usersvv  %
.vv% &
Findvv& *
(vv* +
idvv+ -
)vv- .
;vv. /
ifww 
(ww 
userww 
!=ww 
nullww 
)ww 
{xx 
_contextyy 
.yy 
Usersyy 
.yy 
Removeyy %
(yy% &
useryy& *
)yy* +
;yy+ ,
_contextzz 
.zz 
SaveChangeszz $
(zz$ %
)zz% &
;zz& '
}{{ 
}|| 	
public
 
static
 
void
  
CreatePasswordHash
 -
(
- .
string
. 4
password
5 =
,
= >
out
? B
byte
C G
[
G H
]
H I
passwordHash
J V
,
V W
out
X [
byte
\ `
[
` a
]
a b
passwordSalt
c o
)
o p
{
 	
if
 
(
 
password
 
==
 
null
  
)
  !
throw
" '
new
( +#
ArgumentNullException
, A
(
A B
nameof
B H
(
H I
password
I Q
)
Q R
)
R S
;
S T
if
 
(
 
string
 
.
  
IsNullOrWhiteSpace
 )
(
) *
password
* 2
)
2 3
)
3 4
throw
5 :
new
; >
ArgumentException
? P
(
P Q
$strQ 
, 
nameof 
( 
password 
) 
) 
; 
using
 
(
 
var
 
hmac
 
=
 
new
 !
System
" (
.
( )
Security
) 1
.
1 2
Cryptography
2 >
.
> ?

HMACSHA512
? I
(
I J
)
J K
)
K L
{
 
passwordSalt
 
=
 
hmac
 #
.
# $
Key
$ '
;
' (
passwordHash
 
=
 
hmac
 #
.
# $
ComputeHash
$ /
(
/ 0
System
0 6
.
6 7
Text
7 ;
.
; <
Encoding
< D
.
D E
UTF8
E I
.
I J
GetBytes
J R
(
R S
password
S [
)
[ \
)
\ ]
;
] ^
}
 
}
 	
public
 
static
 
bool
  
VerifyPasswordHash
 -
(
- .
string
. 4
password
5 =
,
= >
byte
? C
[
C D
]
D E

storedHash
F P
,
P Q
byte
R V
[
V W
]
W X

storedSalt
Y c
)
c d
{
 	
if
 
(
 
password
 
==
 
null
  
)
  !
throw
" '
new
( +#
ArgumentNullException
, A
(
A B
nameof
B H
(
H I
password
I Q
)
Q R
)
R S
;
S T
if
 
(
 
string
 
.
  
IsNullOrWhiteSpace
 )
(
) *
password
* 2
)
2 3
)
3 4
throw
5 :
new
; >
ArgumentException
? P
(
P Q
$strQ 
, 
nameof 
( 
password 
) 
) 
; 
if
 
(
 

storedHash
 
.
 
Length
 !
!=
" $
$num
% '
)
' (
throw
) .
new
/ 2
ArgumentException
3 D
(
D E
$str
E {
,
{ |
nameof} 
( 
password 
) 
) 
; 
if
 
(
 

storedSalt
 
.
 
Length
 !
!=
" $
$num
% (
)
( )
throw
* /
new
0 3
ArgumentException
4 E
(
E F
$str
F }
,
} ~
nameof 
( 
password 
) 
) 
; 
using
 
(
 
var
 
hmac
 
=
 
new
 !
System
" (
.
( )
Security
) 1
.
1 2
Cryptography
2 >
.
> ?

HMACSHA512
? I
(
I J

storedSalt
J T
)
T U
)
U V
{
 
var
 
computedHash
  
=
! "
hmac
# '
.
' (
ComputeHash
( 3
(
3 4
System
4 :
.
: ;
Text
; ?
.
? @
Encoding
@ H
.
H I
UTF8
I M
.
M N
GetBytes
N V
(
V W
password
W _
)
_ `
)
` a
;
a b
for
 
(
 
int
 
i
 
=
 
$num
 
;
 
i
  !
<
" #
computedHash
$ 0
.
0 1
Length
1 7
;
7 8
i
9 :
++
: <
)
< =
{
 
if
 
(
 
computedHash
 $
[
$ %
i
% &
]
& '
!=
( *

storedHash
+ 5
[
5 6
i
6 7
]
7 8
)
8 9
return
: @
false
A F
;
F G
}
 
}
 
return
 
true
 
;
 
}
 	
}
 
} ©E
<C:\Users\strat\Documents\GitHub\SentiTweet\WebAPI\Startup.cs
	namespace 	
WebAPI
 
{ 
public 

class 
Startup 
{ 
private 
readonly 
IWebHostEnvironment ,
_env- 1
;1 2
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public   
Startup   
(   
IWebHostEnvironment   *
env  + .
,  . /
IConfiguration  0 >
configuration  ? L
)  L M
{!! 	
_env"" 
="" 
env"" 
;"" 
_configuration## 
=## 
configuration## *
;##* +
}$$ 	
public%% 
void%% 
ConfigureServices%% %
(%%% &
IServiceCollection%%& 8
services%%9 A
)%%A B
{&& 	
if'' 
('' 
_env'' 
.'' 
IsProduction'' !
(''! "
)''" #
)''# $
services(( 
.(( 
AddDbContext(( %
<((% &
DataContext((& 1
>((1 2
(((2 3
)((3 4
;((4 5
else)) 
services** 
.** 
AddDbContext** %
<**% &
DataContext**& 1
,**1 2
SqlDataContext**3 A
>**A B
(**B C
)**C D
;**D E
services++ 
.++ 
AddCors++ 
(++ 
)++ 
;++ 
services,, 
.,, 
AddControllers,, #
(,,# $
),,$ %
;,,% &
services-- 
.-- 
AddAutoMapper-- "
(--" #
	AppDomain--# ,
.--, -
CurrentDomain--- :
.--: ;
GetAssemblies--; H
(--H I
)--I J
)--J K
;--K L
var// 
appSettingsSection// "
=//# $
_configuration//% 3
.//3 4

GetSection//4 >
(//> ?
$str//? L
)//L M
;//M N
services00 
.00 
	Configure00 
<00 
AppSettings00 *
>00* +
(00+ ,
appSettingsSection00, >
)00> ?
;00? @
var22 
appSettings22 
=22 
appSettingsSection22 0
.220 1
Get221 4
<224 5
AppSettings225 @
>22@ A
(22A B
)22B C
;22C D
var33 
key33 
=33 
Encoding33 
.33 
ASCII33 $
.33$ %
GetBytes33% -
(33- .
appSettings33. 9
.339 :
Secret33: @
)33@ A
;33A B
services44 
.44 
AddAuthentication44 &
(44& '
x44' (
=>44) +
{55 
x66 
.66 %
DefaultAuthenticateScheme66 +
=66, -
JwtBearerDefaults66. ?
.66? @ 
AuthenticationScheme66@ T
;66T U
x77 
.77 "
DefaultChallengeScheme77 (
=77) *
JwtBearerDefaults77+ <
.77< = 
AuthenticationScheme77= Q
;77Q R
}88 
)88 
.99 
AddJwtBearer99 
(99 
x99 
=>99 
{:: 
x;; 
.;; 
Events;; 
=;; 
new;; 
JwtBearerEvents;; .
{<< 
OnTokenValidated== $
===% &
context==' .
=>==/ 1
{>> 
var?? 
userService?? '
=??( )
context??* 1
.??1 2
HttpContext??2 =
.??= >
RequestServices??> M
.??M N
GetRequiredService??N `
<??` a
IUserService??a m
>??m n
(??n o
)??o p
;??p q
var@@ 
userId@@ "
=@@# $
int@@% (
.@@( )
Parse@@) .
(@@. /
context@@/ 6
.@@6 7
	Principal@@7 @
.@@@ A
Identity@@A I
.@@I J
Name@@J N
)@@N O
;@@O P
varAA 
userAA  
=AA! "
userServiceAA# .
.AA. /
GetByIdAA/ 6
(AA6 7
userIdAA7 =
)AA= >
;AA> ?
ifBB 
(BB 
userBB  
==BB! #
nullBB$ (
)BB( )
{CC 
contextEE #
.EE# $
FailEE$ (
(EE( )
$strEE) 7
)EE7 8
;EE8 9
}FF 
returnGG 
TaskGG #
.GG# $
CompletedTaskGG$ 1
;GG1 2
}HH 
}II 
;II 
xJJ 
.JJ  
RequireHttpsMetadataJJ &
=JJ' (
falseJJ) .
;JJ. /
xKK 
.KK 
	SaveTokenKK 
=KK 
trueKK "
;KK" #
xLL 
.LL %
TokenValidationParametersLL +
=LL, -
newLL. 1%
TokenValidationParametersLL2 K
{MM $
ValidateIssuerSigningKeyNN ,
=NN- .
trueNN/ 3
,NN3 4
IssuerSigningKeyOO $
=OO% &
newOO' * 
SymmetricSecurityKeyOO+ ?
(OO? @
keyOO@ C
)OOC D
,OOD E
ValidateIssuerPP "
=PP# $
falsePP% *
,PP* +
ValidateAudienceQQ $
=QQ% &
falseQQ' ,
}RR 
;RR 
}SS 
)SS 
;SS 
servicesVV 
.VV 
	AddScopedVV 
<VV 
IAnalysisServiceVV /
,VV/ 0
AnalysisServiceVV1 @
>VV@ A
(VVA B
)VVB C
;VVC D
servicesWW 
.WW 
	AddScopedWW 
<WW 
IEvalServiceWW +
,WW+ ,
EvalServiceWW- 8
>WW8 9
(WW9 :
)WW: ;
;WW; <
servicesXX 
.XX 
AddControllersXX #
(XX# $
)XX$ %
;XX% &
servicesYY 
.YY 
AddSwaggerGenYY "
(YY" #
)YY# $
;YY$ %
servicesZZ 
.ZZ #
AddPredictionEnginePoolZZ ,
<ZZ, -

ModelInputZZ- 7
,ZZ7 8
ModelOutputZZ9 D
>ZZD E
(ZZE F
)ZZF G
.ZZG H
FromFileZZH P
(ZZP Q
	modelNameZZQ Z
:ZZZ [
$strZZ\ t
,ZZt u
filePathZZv ~
:ZZ~ 
$str
ZZ 
,
ZZ 
watchForChanges
ZZ 
:
ZZ 
true
ZZ  ¤
)
ZZ¤ ¥
;
ZZ¥ ¦
services[[ 
.[[ 
	AddScoped[[ 
<[[ 
IUserService[[ +
,[[+ ,
UserService[[- 8
>[[8 9
([[9 :
)[[: ;
;[[; <
}\\ 	
public__ 
void__ 
	Configure__ 
(__ 
IApplicationBuilder__ 1
app__2 5
,__5 6
IWebHostEnvironment__7 J
env__K N
)__N O
{`` 	
appaa 
.aa 

UseSwaggeraa 
(aa 
)aa 
;aa 
appbb 
.bb 
UseSwaggerUIbb 
(bb 
cbb 
=>bb !
{cc 
cdd 
.dd 
SwaggerEndpointdd !
(dd! "
$strdd" <
,dd< =
$strdd> O
)ddO P
;ddP Q
}ee 
)ee 
;ee 
ifff 
(ff 
envff 
.ff 
IsDevelopmentff !
(ff! "
)ff" #
)ff# $
{gg 
apphh 
.hh %
UseDeveloperExceptionPagehh -
(hh- .
)hh. /
;hh/ 0
}ii 
appkk 
.kk 

UseRoutingkk 
(kk 
)kk 
;kk 
appnn 
.nn 
UseCorsnn 
(nn 
xnn 
=>nn 
xnn 
.oo 
AllowAnyOriginoo 
(oo  
)oo  !
.pp 
AllowAnyMethodpp 
(pp  
)pp  !
.qq 
AllowAnyHeaderqq 
(qq  
)qq  !
)qq! "
;qq" #
appss 
.ss 
UseAuthenticationss !
(ss! "
)ss" #
;ss# $
apptt 
.tt 
UseAuthorizationtt  
(tt  !
)tt! "
;tt" #
appuu 
.uu 
UseEndpointsuu 
(uu 
	endpointsuu &
=>uu' )
{vv 
	endpointsww 
.ww 
MapControllersww (
(ww( )
)ww) *
;ww* +
}xx 
)xx 
;xx 
}yy 	
}zz 
}{{ 